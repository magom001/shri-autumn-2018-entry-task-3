# Алгоритм работы умного дома

Цель задания — реализовать алгоритм работы «умного дома», который будет производить расчёт стоимости
потребляемой электроэнергии в день и возвращать рекомендованное расписание использования электроприборов,
оптимизируя денежные затраты.
На вход подаются данные о тарифах, электроприборах и их максимальной потребляемой мощности.
Тарифы — это периоды в сутках, для которых задана отдельная стоимость киловатт-часа.
Приборы — это набор подключенных к «умному дому» электроприборов, для которых известна потребляемая мощность,
длительность цикла работы, а также время дня, когда они используется. Каждый прибор должен отработать один
цикл в сутки. Максимально потребляемая мощность указывается в ватт-часах.
На выходе должно получиться суточное расписание включения электроприборов. Каждый прибор за сутки должен
отработать один цикл, а суммарная стоимость потраченной электроэнергии должна быть минимальной.

- При значении mode — day период с 07:00 до 21:00.
- При значении mode — night период с 21:00 до 07:00 следующего дня.
- При значении mode — undefined период отсутствует, прибор может работать в любой промежуток времени.

### ПРИМЕР ВХОДНЫХ ДАННЫХ

```
{
    "devices": [
        {
        "id": "F972B82BA56A70CC579945773B6866FB",
        "name": "Посудомоечная машина",
        "power": 950,
        "duration": 3,
        "mode": "night"
        },
        {
        "id": "C515D887EDBBE669B2FDAC62F571E9E9",
        "name": "Духовка",
        "power": 2000,
        "duration": 2,
        "mode": "day"
        },
        {
        "id": "02DDD23A85DADDD71198305330CC386D",
        "name": "Холодильник",
        "power": 50,
        "duration": 24
        },
        {
        "id": "1E6276CC231716FE8EE8BC908486D41E",
        "name": "Термостат",
        "power": 50,
        "duration": 24
        },
        {
        "id": "7D9DC84AD110500D284B33C82FE6E85E",
        "name": "Кондиционер",
        "power": 850,
        "duration": 1
        }
    ],
    "rates": [
        {
        "from": 7,
        "to": 10,
        "value": 6.46
        },
        {
        "from": 10,
        "to": 17,
        "value": 5.38
        },
        {
        "from": 17,
        "to": 21,
        "value": 6.46
        },
        {
        "from": 21,
        "to": 23,
        "value": 5.38
        },
        {
        "from": 23,
        "to": 7,
        "value": 1.79
        }
    ],
    "maxPower": 2100
}
```

### Пример данных на выходе

```
{
    "schedule": {
        "0": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E", "F972B82BA56A70CC579945773B6866FB"],
        "1": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E", "F972B82BA56A70CC579945773B6866FB"],
        "2": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E", "F972B82BA56A70CC579945773B6866FB"],
        "3": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "4": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "5": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "6": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "7": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "8": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "9": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "10": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E", "C515D887EDBBE669B2FDAC62F571E9E9"],
        "11": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E", "C515D887EDBBE669B2FDAC62F571E9E9"],
        "12": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "13": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "14": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "15": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "16": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "17": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "18": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "19": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "20": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "21": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "22": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E"],
        "23": ["02DDD23A85DADDD71198305330CC386D", "1E6276CC231716FE8EE8BC908486D41E", "7D9DC84AD110500D284B33C82FE6E85E"]
    },
    "consumedEnergy": {
        "value": 38.939,
        "devices": {
        "F972B82BA56A70CC579945773B6866FB": 5.1015,
        "C515D887EDBBE669B2FDAC62F571E9E9": 21.52,
        "02DDD23A85DADDD71198305330CC386D": 5.398,
        "1E6276CC231716FE8EE8BC908486D41E": 5.398,
        "7D9DC84AD110500D284B33C82FE6E85E": 1.5215
        }
    }
}
```

##

## Цель задания

Пусть

![](https://latex.codecogs.com/gif.latex?A%3D%5Cbegin%7Bbmatrix%7D%20a_%7B11%7D%20%26%20a_%7B12%7D%20%26%20...%20%26%20a_%7B1n%7D%5C%5C%20a_%7B21%7D%20%26%20a_%7B12%7D%20%26%20...%20%26%20a_%7B1n%7D%5C%5C%20...%20%26%20...%20%26%20...%20%26%20...%5C%5C%20a_%7Bt1%7D%20%26%20a_%7Bt2%7D%20%26%20...%20%26%20a_%7Btn%7D%20%5Cend%7Bbmatrix%7D)

\- бинарная матрица, где ![](https://latex.codecogs.com/gif.latex?a_%7Bti%7D%3D%5C%7B0%2C%201%5C%7D%20%5C%20%5Cforall%20i%5Cin%20%5C%7B0%2C%201%2C...%2Cn%5C%7D) - состояние устройства _i_ в момент _t_. 0 - устройство выключено, 1 - устройство включено.

Пусть

![](https://latex.codecogs.com/gif.latex?W%3D%20%5Cbegin%7Bpmatrix%7D%20w_%7B1%7D%5C%5C%20w_%7B2%7D%5C%5C%20...%5C%5C%20w_%7Bn%7D%20%5Cend%7Bpmatrix%7D)

\- вектор энергопотребления, где ![](https://latex.codecogs.com/gif.latex?w_%7Bi%7D) энергопотрбеление устройства _i_ для _i_ = {1, 2, ..., n}

Тогда

![](https://latex.codecogs.com/gif.latex?C%3DA%5Ccdot%20W%3D%5Cbegin%7Bbmatrix%7D%20a_%7B11%7D%20%26%20a_%7B12%7D%20%26%20...%20%26%20a_%7B1n%7D%5C%5C%20a_%7B21%7D%20%26%20a_%7B12%7D%20%26%20...%20%26%20a_%7B1n%7D%5C%5C%20...%20%26%20...%20%26%20...%20%26%20...%5C%5C%20a_%7Bt1%7D%20%26%20a_%7Bt2%7D%20%26%20...%20%26%20a_%7Btn%7D%20%5Cend%7Bbmatrix%7D%20%5Cbegin%7Bpmatrix%7D%20w_%7B1%7D%5C%5C%20w_%7B2%7D%5C%5C%20...%5C%5C%20w_%7Bn%7D%20%5Cend%7Bpmatrix%7D%20%3D%5Cbegin%7Bpmatrix%7D%20c_%7B1%7D%5C%5C%20c_%7B2%7D%5C%5C%20...%5C%5C%20c_%7Bt%7D%20%5Cend%7Bpmatrix%7D)

\- вектор энергопотребления всех включенных устройств в момент времени _t_.

Пусть

![](https://latex.codecogs.com/gif.latex?R%3D%20%5Cbegin%7Bpmatrix%7D%20r_%7B1%7D%5C%5C%20r_%7B2%7D%5C%5C%20...%5C%5C%20r_%7Bt%7D%20%5Cend%7Bpmatrix%7D)

\- вектор тарифов электроэнергии, где ![](https://latex.codecogs.com/gif.latex?r_%7Bt%7D) - стоимость 1 ед. энергии в момент времени _t_.

Тогда

![](https://latex.codecogs.com/gif.latex?Expense%3DC%5Ccdot%20R)

\- общая стоимость электроэнергии за интервал времени 1 - _t_.

Необходимо найти такую _A_, при которой _Expense_ - минимальна при условии соблюдения следующих условий:

1.  ![](https://latex.codecogs.com/gif.latex?c_%7Bt%7D) <= ![](https://latex.codecogs.com/gif.latex?C_%7Bmax%7D) для всех _t_, где ![](https://latex.codecogs.com/gif.latex?C_%7Bmax%7D) - максимально доступная мощность;
2.  Каждое устройство должно отработать минимум один цикл: ![](https://latex.codecogs.com/gif.latex?%5Cleft%20%28%20%5Cexists%20a_%7Bit%7D%20%5Cin%20%5Cleft%20%28%20a_%7Bi1%7D%2C%20a_%7Bi2%7D%2C%20...%2C%20a_%7Bit%7D%20%5Cright%20%29%20%5Cright%20%29%5Cleft%28a_%7Bit%7D%3D1%20%5Cright%20%29). Один цикл длится от 1 до максимум _t_ временных интервалов;
3.  У устройства может быть факультативный параметр 'mode', ограничивающий интервал времени _t_, в который устройство может быть включено: ![](https://latex.codecogs.com/gif.latex?%5Cforall%20t%5Cnotin%20T_%7Bmode%7D%5C%20a_%7Bit%7D%3D0), где ![](https://latex.codecogs.com/gif.latex?T_%7Bmode%7D) - множество интервалов времени для данного _mode_.

##

## Принцип работы алгоритма

1.  Из списка устройств выбираются те, которые должны работать круглосуточно: для этих устройство ![](https://latex.codecogs.com/gif.latex?a_%7Bti%7D%3D1%20%5C%20%5Cforall%20i%5Cin%20%5C%7B0%2C%201%2C...%2Cn%5C%7D);
2.  Оставшиеся устройства сортируются по энергопотреблению в убывающием порядке;
3.  Для каждого устройства из отсортированного списка рассчитывается стоимость работы одного цикла с учетом начала цикла в интервал _t_. Из полученных результатов выбираем минимальное значение и всем соответствующим ![](https://latex.codecogs.com/gif.latex?a_%7Bti%7D) в матрице _A_ присваиваем 1.

## Автор

- **Аркадий Магомедов**
